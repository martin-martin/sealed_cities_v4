<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Sealed Cities</title>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <style type="text/css">
            .example {
                display: flex;
                flex-wrap: wrap;
                width: 400px;
            }
        </style>
        <script type="text/javascript">

function draw(data) {
    // here comes the logic of creating things
            d3.select('body').append('p').text('% of cities with more than 50% of their grounds sealed!');
            d3.select('body').append('div').attr('class', 'container');

            d3.select('.container').selectAll('div')
                .data(data)
                .enter()
                .append('div')
                .text(function(d) {
                    if (d.country === "United Kingdom") {
                        return "U.K.";
                    } else {
                    return d.country;
                    }
                  })
                .style('width', function(d) {
                    return d.sum_of_cities + '%'
                })
                .style('color', 'black')
                .style('background-color', 'red')
                .style('border-color', 'white')
                .style('border-style', 'solid')
                .style('border-width', '1px');
debugger;

                // logic for creating the visualization with houses and trees

                // some values for testing
                // var data = [
                //     {"amount" : 8},
                //     {"amount" : 1},
                //     {"amount" : 37}
                // ];


                // here come the functions
                d3.select('body').append('span').attr('class', 'example');

// modify the initial data
    data.forEach(function(d){
            // calling the function to generate the range for each row entry
            d.num_blocks = d3.range(0,d.total_sealed_in_percent,1);
            d.num_squares = d3.range(0,100 - d.total_sealed_in_percent,1);
    })

    // insert a div for each row
    var rows = d3.select('.example').selectAll('div')
        .data(data, function(d, i) {
            // binding a kew to each row. It is not really necessary on this example
            // but I will leave it here to make the use of key functions clear
            return "row_" + i;
        })
        .enter()
        .append('div');

    // insert imgs with class block in each row
    var blocks = rows.selectAll('.block')
            .data(function (d){
                return d.num_blocks
            })
            .enter()
            .append('img')
                .attr('class', 'block')
                .attr('src', 'img/little_house2.png')
                .attr('alt', 'example block')
                .style('width', '40px')
                .style('height', '40px')

    // insert imgs with class squares in each row
    var squares = rows.selectAll('.square')
            .data(function (d){
                return d.num_squares
            })
            .enter()
            .append('img')
                .attr('class', 'square')
                .attr('src', 'img/tree.svg')
                .attr('alt', 'example square')
                .style('width', '40px')
                .style('height', '40px');



              };

        </script>
    </head>
    <body>
        <script type="text/javascript">

//             var data = [
//    {
//       "country":"Cyprus",
//       "50_to_74_percent":2,
//       "total_sealed_in_percent":62.0,
//       "sum_of_cities":2,
//       "25_to_49_percent":0,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":100,
//       "below_25_percent":0
//    },
//    {
//       "country":"Estonia",
//       "50_to_74_percent":2,
//       "total_sealed_in_percent":62.0,
//       "sum_of_cities":2,
//       "25_to_49_percent":0,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":100,
//       "below_25_percent":0
//    },
//    {
//       "country":"Luxembourg",
//       "50_to_74_percent":1,
//       "total_sealed_in_percent":62.0,
//       "sum_of_cities":1,
//       "25_to_49_percent":0,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":100,
//       "below_25_percent":0
//    },
//    {
//       "country":"Greece",
//       "50_to_74_percent":7,
//       "total_sealed_in_percent":65.0,
//       "sum_of_cities":10,
//       "25_to_49_percent":1,
//       "75_and_above_percent":2,
//       "percentage_cities_50_and_above_percent":90,
//       "below_25_percent":0
//    },
//    {
//       "country":"Hungary",
//       "50_to_74_percent":8,
//       "total_sealed_in_percent":59.0,
//       "sum_of_cities":9,
//       "25_to_49_percent":1,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":89,
//       "below_25_percent":0
//    },
//    {
//       "country":"Romania",
//       "50_to_74_percent":22,
//       "total_sealed_in_percent":61.0,
//       "sum_of_cities":27,
//       "25_to_49_percent":3,
//       "75_and_above_percent":2,
//       "percentage_cities_50_and_above_percent":89,
//       "below_25_percent":0
//    },
//    {
//       "country":"Slovakia",
//       "50_to_74_percent":7,
//       "total_sealed_in_percent":59.0,
//       "sum_of_cities":8,
//       "25_to_49_percent":1,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":88,
//       "below_25_percent":0
//    },
//    {
//       "country":"Croatia",
//       "50_to_74_percent":4,
//       "total_sealed_in_percent":57.0,
//       "sum_of_cities":5,
//       "25_to_49_percent":1,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":80,
//       "below_25_percent":0
//    },
//    {
//       "country":"Poland",
//       "50_to_74_percent":35,
//       "total_sealed_in_percent":56.0,
//       "sum_of_cities":45,
//       "25_to_49_percent":10,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":78,
//       "below_25_percent":0
//    },
//    {
//       "country":"Spain",
//       "50_to_74_percent":41,
//       "total_sealed_in_percent":58.0,
//       "sum_of_cities":60,
//       "25_to_49_percent":13,
//       "75_and_above_percent":5,
//       "percentage_cities_50_and_above_percent":77,
//       "below_25_percent":1
//    },
//    {
//       "country":"Bulgaria",
//       "50_to_74_percent":6,
//       "total_sealed_in_percent":56.0,
//       "sum_of_cities":8,
//       "25_to_49_percent":2,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":75,
//       "below_25_percent":0
//    },
//    {
//       "country":"Czech Republic",
//       "50_to_74_percent":10,
//       "total_sealed_in_percent":55.0,
//       "sum_of_cities":14,
//       "25_to_49_percent":4,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":71,
//       "below_25_percent":0
//    },
//    {
//       "country":"Germany",
//       "50_to_74_percent":60,
//       "total_sealed_in_percent":55.0,
//       "sum_of_cities":85,
//       "25_to_49_percent":25,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":71,
//       "below_25_percent":0
//    },
//    {
//       "country":"Latvia",
//       "50_to_74_percent":2,
//       "total_sealed_in_percent":54.0,
//       "sum_of_cities":3,
//       "25_to_49_percent":1,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":67,
//       "below_25_percent":0
//    },
//    {
//       "country":"Ireland",
//       "50_to_74_percent":3,
//       "total_sealed_in_percent":52.0,
//       "sum_of_cities":5,
//       "25_to_49_percent":2,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":60,
//       "below_25_percent":0
//    },
//    {
//       "country":"Lithuania",
//       "50_to_74_percent":3,
//       "total_sealed_in_percent":52.0,
//       "sum_of_cities":5,
//       "25_to_49_percent":2,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":60,
//       "below_25_percent":0
//    },
//    {
//       "country":"Italy",
//       "50_to_74_percent":29,
//       "total_sealed_in_percent":52.0,
//       "sum_of_cities":49,
//       "25_to_49_percent":20,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":59,
//       "below_25_percent":0
//    },
//    {
//       "country":"The Netherlands",
//       "50_to_74_percent":20,
//       "total_sealed_in_percent":51.0,
//       "sum_of_cities":35,
//       "25_to_49_percent":15,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":57,
//       "below_25_percent":0
//    },
//    {
//       "country":"France",
//       "50_to_74_percent":17,
//       "total_sealed_in_percent":51.0,
//       "sum_of_cities":31,
//       "25_to_49_percent":14,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":55,
//       "below_25_percent":0
//    },
//    {
//       "country":"Portugal",
//       "50_to_74_percent":9,
//       "total_sealed_in_percent":49.0,
//       "sum_of_cities":19,
//       "25_to_49_percent":10,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":47,
//       "below_25_percent":0
//    },
//    {
//       "country":"Austria",
//       "50_to_74_percent":2,
//       "total_sealed_in_percent":47.0,
//       "sum_of_cities":5,
//       "25_to_49_percent":3,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":40,
//       "below_25_percent":0
//    },
//    {
//       "country":"Belgium",
//       "50_to_74_percent":2,
//       "total_sealed_in_percent":41.0,
//       "sum_of_cities":7,
//       "25_to_49_percent":4,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":29,
//       "below_25_percent":1
//    },
//    {
//       "country":"Switzerland",
//       "50_to_74_percent":1,
//       "total_sealed_in_percent":43.0,
//       "sum_of_cities":4,
//       "25_to_49_percent":3,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":25,
//       "below_25_percent":0
//    },
//    {
//       "country":"Denmark",
//       "50_to_74_percent":1,
//       "total_sealed_in_percent":43.0,
//       "sum_of_cities":4,
//       "25_to_49_percent":3,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":25,
//       "below_25_percent":0
//    },
//    {
//       "country":"United Kingdom",
//       "50_to_74_percent":11,
//       "total_sealed_in_percent":39.0,
//       "sum_of_cities":106,
//       "25_to_49_percent":94,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":10,
//       "below_25_percent":1
//    },
//    {
//       "country":"Finland",
//       "50_to_74_percent":0,
//       "total_sealed_in_percent":37.0,
//       "sum_of_cities":4,
//       "25_to_49_percent":4,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":0,
//       "below_25_percent":0
//    },
//    {
//       "country":"Malta",
//       "50_to_74_percent":0,
//       "total_sealed_in_percent":25.0,
//       "sum_of_cities":2,
//       "25_to_49_percent":1,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":0,
//       "below_25_percent":1
//    },
//    {
//       "country":"Norway",
//       "50_to_74_percent":0,
//       "total_sealed_in_percent":37.0,
//       "sum_of_cities":6,
//       "25_to_49_percent":6,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":0,
//       "below_25_percent":0
//    },
//    {
//       "country":"Sweden",
//       "50_to_74_percent":0,
//       "total_sealed_in_percent":33.0,
//       "sum_of_cities":12,
//       "25_to_49_percent":10,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":0,
//       "below_25_percent":2
//    },
//    {
//       "country":"Slovenia",
//       "50_to_74_percent":0,
//       "total_sealed_in_percent":37.0,
//       "sum_of_cities":2,
//       "25_to_49_percent":2,
//       "75_and_above_percent":0,
//       "percentage_cities_50_and_above_percent":0,
//       "below_25_percent":0
//    }
// ]

          d3.csv('soil_sealing_cities.csv', function(error, data) {
            function nullcheck(d, col_old, col_new) {
                if (d.col_new === 'null') {
                  d.col_new = 0;
                } else {
                  d.col_new = +d[col_old];
                };
              };
            data.forEach(function(d) {
              d.country = d.nuts0;
              nullcheck(d, "< 25 %", cat_below_25_percent);
              nullcheck(d, "25-49 %", cat_25_to_49_percent);
              nullcheck(d, "50-74 %", cat_50_to_74_percent);
              nullcheck(d, ">= 75 %", cat_75_and_above_percent);
              d.sum_of_cities = +d.sum;
              d.percentage_cities_50_and_above_percent = d["percentage of cities >=50%"];
            });
          },
            draw);

            // function(d) {
            //   console.log(d.cat_below_25_percent)
            // };


              // d.cat_25_to_49_percent = +d["25-49 %"];
              // d.cat_50_to_74_percent = +d["50-74 %"];
              // d.cat_75_and_above_percent = +d[">= 75 %"];


          // });
        </script>
    </body>
</html>



              <!-- country : d.nuts0,
              cat_below_25_percent : +d["< 25 %"],
              cat_25_to_49_percent : +d["25-49 %"],
              cat_50_to_74_percent : +d["50-74 %"],
              cat_75_and_above_percent : +d[">= 75 %"],
              sum_of_cities : +d.sum,
              percentage_cities_50_and_above_percent : d["percentage of cities >=50%"] -->